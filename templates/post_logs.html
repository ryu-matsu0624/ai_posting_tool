{% extends "base.html" %}

{% block content %}
<h2>ğŸ“‘ æŠ•ç¨¿ãƒ­ã‚°ï¼ˆã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨çŠ¶æ…‹ã®å¯è¦–åŒ–ï¼‰</h2>

<table class="table table-striped">
  <thead>
    <tr>
      <th>ğŸ“ ã‚µã‚¤ãƒˆå</th>
      <th>ğŸ“Œ ã‚¿ã‚¤ãƒˆãƒ«</th>
      <th>ğŸ“Š çŠ¶æ…‹</th>
      <th>â° æŠ•ç¨¿äºˆå®š</th>
      <th>ğŸ“„ è©³ç´°ãƒ­ã‚°</th>
      <th>ğŸ”§ æ“ä½œ</th>
    </tr>
  </thead>
  <tbody>
    {% for article in articles %}
    <tr>
      <!-- ã‚µã‚¤ãƒˆå -->
      <td>{{ article.site.site_name }}</td>

      <!-- è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ« -->
      <td>{{ article.title }}</td>

      <!-- çŠ¶æ…‹ -->
      <td>
        {% if article.status == 'posted' %}
          <span class="badge bg-success" title="ã“ã®è¨˜äº‹ã¯æŠ•ç¨¿æ¸ˆã¿ã§ã™">ğŸš€ æŠ•ç¨¿æ¸ˆã¿</span>
        {% elif article.status == 'scheduled' %}
          <span class="badge bg-info text-dark" title="è¨˜äº‹ã¯æŠ•ç¨¿å¾…ã¡ã®çŠ¶æ…‹ã§ã™">âœ… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ¸ˆã¿</span>
        {% elif article.status == 'pending' %}
          <span class="badge bg-warning text-dark" title="ç¾åœ¨AIãŒè¨˜äº‹ã‚’ç”Ÿæˆä¸­ã§ã™">â³ ç”Ÿæˆä¸­</span>
        {% elif article.status == 'error' %}
          <span class="badge bg-danger" title="è¨˜äº‹ç”Ÿæˆã¾ãŸã¯æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ">âŒ ã‚¨ãƒ©ãƒ¼</span>
        {% else %}
          <span class="badge bg-secondary">â“ {{ article.status }}</span>
        {% endif %}
      </td>

      <!-- ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« -->
      <td>
        {% if article.scheduled_time %}
          ğŸ“… {{ article.scheduled_time.strftime('%Y-%m-%d') }}<br>
          ğŸ•’ {{ article.scheduled_time.strftime('%H:%M') }}
        {% else %}
          <span class="text-muted">æœªè¨­å®š</span>
        {% endif %}
      </td>

      <!-- ãƒ­ã‚°æƒ…å ± -->
      <td>
        {% set latest_log = article.post_logs|last %}
        {% if latest_log %}
          <details>
            <summary>
              {{ latest_log.status }}ï¼ˆ{{ latest_log.timestamp.strftime('%Y-%m-%d %H:%M') }})
            </summary>
            <pre style="white-space: pre-wrap; font-size: 12px; max-width: 400px;">
{{ latest_log.response_message }}
            </pre>
          </details>
        {% else %}
          <span class="text-muted">ï¼ˆãƒ­ã‚°ãªã—ï¼‰</span>
        {% endif %}
      </td>

      <!-- æ“ä½œ -->
      <td>
        {% if article.status in ['scheduled', 'posted'] %}
          <a href="{{ url_for('preview_article', article_id=article.id) }}"
             class="btn btn-outline-primary btn-sm">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</a>

          {% if article.status == "scheduled" %}
            <a href="{{ url_for('edit_article', article_id=article.id) }}"
               class="btn btn-outline-secondary btn-sm">ç·¨é›†</a>
          {% endif %}
        {% elif article.status == 'error' %}
          <a href="{{ url_for('generate_article', site_id=article.site.id, keyword=article.keyword) }}"
             class="btn btn-sm btn-danger">ğŸ” å†ç”Ÿæˆ</a>
        {% else %}
          <span class="text-muted">ï¼</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
